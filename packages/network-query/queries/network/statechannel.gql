# Copyright 2020-2022 SubQuery Pte Ltd authors & contributors
# SPDX-License-Identifier: Apache-2.0

fragment StateChannelFields on StateChannel {
  id
  indexer
  consumer
  status
  total
  spent
  price
  isFinal
  expiredAt
  terminatedAt
  deploymentId
  terminateByIndexer
}

query GetPaygPlans($indexer: String!, $deploymentId: String!, $status: ChannelStatus!) {
  stateChannels(
    filter: {
      indexer: { equalTo: $indexer }
      status: { equalTo: $status }
      deploymentId: { equalTo: $deploymentId }
    }
  ) {
    nodes {
      ...StateChannelFields
    }
  }
}

query GetStateChannels($status: ChannelStatus!) {
  stateChannels(filter: { status: { equalTo: $status } }) {
    nodes {
      ...StateChannelFields
    }
  }
}

query GetClosedStateChannels($date: Datetime!) {
  stateChannels(filter: { status: { equalTo: OPEN }, expiredAt: { lessThanOrEqualTo: $date } }) {
    nodes {
      ...StateChannelFields
    }
  }
}
